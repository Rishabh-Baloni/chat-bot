ğŸ“„ FINAL BUILD SPEC â€” CHATBOT FRAMEWORK + WIDGET SYSTEM
ğŸ· PRODUCT NAME (Concept)

Self-Hosted Knowledge-Driven Chatbot Engine with Embeddable Web Widget

ğŸ¯ FINAL PRODUCT GOAL

Build a self-hostable chatbot system that:

Runs on Render (user deploys themselves)

Uses:

Grok API â†’ Main Chat Reasoning (NAT / Conversation)

Gemini API â†’ Knowledge Expansion + Structuring (Single Prompt Heavy Work)

Provides:

Embeddable JS Widget for integration into any web app

Uses:

Local knowledge files (JSON)

Rule files (TXT)

Uses:

Userâ€™s own API keys

No shared DB, No shared API usage from owner

ğŸ§± FINAL SYSTEM ARCHITECTURE
User Website
 â†“
Embeds Chat Widget JS
 â†“
Widget Calls Userâ€™s Render Chatbot Backend
 â†“
Backend Loads:
   Rules
   Knowledge JSON
 â†“
Backend Calls Grok API
 â†“
Returns Chat Response

ğŸ§  AI MODEL RESPONSIBILITY SPLIT
ğŸ¤– Grok API (Primary Runtime Brain)

Used for:

Natural conversation

Context reasoning

Rule following

Knowledge grounded answers

Not used for:

Knowledge generation

Bulk summarization

Dataset building

ğŸ§ª Gemini API (Background Knowledge Processor)

Used for:

Knowledge expansion

Knowledge structuring

Multi-task processing in Single Prompt

Converting raw info â†’ structured knowledge JSON

Must be designed so:
ğŸ‘‰ 1 prompt = multiple outputs
ğŸ‘‰ Reduce daily API calls usage

ğŸ“‚ REQUIRED PROJECT STRUCTURE
project_root/

app/
 â”œ main.py
 â”œ chat_api.py
 â”œ grok_client.py
 â”œ gemini_client.py
 â”œ knowledge_manager.py
 â”œ rule_engine.py
 â”œ prompt_builder.py

widget/
 â”œ widget.js
 â”œ widget.css

knowledge/
 â”œ core_knowledge.json
 â”œ expanded_knowledge.json

rules/
 â”œ rules.txt

.env.example
requirements.txt
README.md

ğŸŒ BACKEND REQUIREMENTS (FASTAPI â€” RENDER DEPLOYABLE)
REQUIRED API ENDPOINTS
POST /chat

Input:

message
session_id


Process:

Load rules

Load knowledge

Build prompt

Call Grok API

Return response

POST /expand-knowledge

Input:

raw_text
source_tag


Process:

Send to Gemini (single heavy prompt)

Receive structured knowledge JSON

Append to expanded_knowledge.json

ğŸ“š KNOWLEDGE SYSTEM DESIGN
Core Knowledge

Static, verified.

Expanded Knowledge

Gemini generated structured entries.

Knowledge JSON ENTRY FORMAT
{
  "topic": "",
  "symptoms_or_keywords": [],
  "response_guidance": "",
  "risk_level": "",
  "confidence": "",
  "source": ""
}

ğŸ§  GEMINI SINGLE PROMPT STRATEGY

Prompt must request:

1ï¸âƒ£ Extract structured knowledge
2ï¸âƒ£ Remove hallucinations
3ï¸âƒ£ Add confidence score
4ï¸âƒ£ Add risk level
5ï¸âƒ£ Output valid JSON

Single API call â†’ Full processing.

ğŸ¤– GROK PROMPT STRATEGY

Prompt must include:

Rule file content

Matched knowledge entries

User message

Medical disclaimer template

ğŸ§© JS CHAT WIDGET REQUIREMENTS
Widget Must:

âœ” Create floating button (bottom right)
âœ” Open chat popup window
âœ” Send messages to backend
âœ” Maintain session
âœ” Be embeddable via single script tag

EMBED METHOD (FINAL)

User adds to website:

<script src="https://their-domain/widget.js"></script>

ğŸ–¥ WIDGET UI BEHAVIOR
Default State

Floating circular button

On Click

Open chat window panel

Chat Window

Header

Chat messages

Input box

Send button

ğŸ”‘ CONFIGURATION SYSTEM
ENV VARIABLES (USER PROVIDED)
GROK_API_KEY=
GEMINI_API_KEY=
LLM_PROVIDER=grok

ğŸ§  PROMPT BUILDING FLOW
Chat Request
Rules
+
Top Knowledge Matches
+
User Message
+
Safety Template


â†’ Send to Grok

ğŸ”„ KNOWLEDGE EXPANSION FLOW
User / Admin Adds Raw Info
â†“
Backend Sends To Gemini
â†“
Gemini Returns Structured JSON
â†“
Append To Expanded Knowledge File

ğŸŒ DEPLOYMENT TARGET
Required

Must deploy on:
ğŸ‘‰ Render Free Tier

Must Support

Environment variables

CORS for widget domain access

ğŸ” SECURITY REQUIREMENTS

Must implement:

Rate limiting basic

API key hidden server side

Input sanitization

ğŸ§ª PERFORMANCE TARGET

Chat response < 5 sec (excluding cold start)

Widget load < 1 sec

ğŸ† FINAL PRODUCT CAPABILITY

End user can:

Deploy chatbot on their Render

Plug their API keys

Add knowledge

Embed chatbot into ANY website using widget.js

â­ FINAL PRODUCT IDENTITY

This is a Self-Hosted AI Chatbot Engine + Universal Web Widget Integration System using Grok for real-time reasoning and Gemini for structured knowledge expansion via single high-efficiency prompt processing.